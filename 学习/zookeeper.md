### zookeeper学习笔记

#### 1、什么是zookeeper，有什么作用，
#### 2、zookeeper的设计目标
#### 4、在什么场景下使用
 - 注册中心
 - 统一命名服务
 - 分布式锁服务
 - 配置管理
 - 注册于发现
 - master选举
 - 分布式锁
 - 队列管理
 -
#### 5、zookeeper的内部实现原理
 - zookeeper的核心是原则广播
 - 实现的是zab协议（恢复模式和广播模式）
 - 选主，重启或者leader或者过半服务服务器与leader不能通讯，进入恢复模式选主
 - 同步，状态保证leader和server有相同的系统状态
#### 6、作为服务注册中心 eureka比zookeeper好在哪里
#### 7、zookeeper提供的能力
 - 文件系统
 - 通知机制
#### 8、什么是zookeeper的文件系统
 - zookeeper的文件系统在每一个节点上都可以保存数据，包括目录节点
 - 由于zookeeper的整个文件节点树都在内存中，所以存储的数据不能太大，不能超过1M
#### 9、zookeeper有哪几种节点类型
 - 持久节点，除非删除一直存在
 - 持久顺序节点，保证创建的顺序
 - 临时节点，不能建立子节点，在会话失效后消失
 - 临时顺序节点，保证节点的创建顺序，由父节点维护
#### 10、zookeeper的通知机制是什么
 - 客户端可以在服务器对于某个事件进行监听，注册，处理，回调
 - 一次性监听，在回调一次后自动删除监听
 - 客户端串行执行，对于监听的回调都是串行的
 - 轻量级watch，只是一个bool的标记处理，不会传递具体的对象
 - 由于网络的问题，客户端并不会接受到每一次节点变化，zookeeper至保证最终一致性，不能保证强一致性
 - watch事件可能被丢失，在断开连接和重新连接
#### 11、一次性监听，那怎么做到多次通知机制
#### 12、zookeeper采用什么权限控制机制
 - 权限模式
   - ip。对于ip地址粒度权限控制
   - 用户名和密码方式
   - world，所有人可以访问
   - supper，超级用户
 - 授权对象，一个ip，用户，
 - 权限
   - 创建权限
   - 删除权限
   - 读权限
   - 写权限
   - 管理权限
#### 13、zookeeper为什么需要权限控制机制
#### 14、什么是chroot特性
 - 允许每个用户给自己定义命名空间
 - 可以隔离多个应用，通常在一个子树下进行
#### 15、zookeeper的会话管理机制是什么样子
 - 客户端在和服务器建立连接的时候，会维护一组服务端信息，客户端选择一个服务器进行连接，服务器会为每个连接分配一个唯一标示
 - 客户端如果在指定溢出时间内，没有心跳发出，服务端会标记为下线
 - 客户端如果检测到与服务器断开连接后，会终于另一个服务端进行重连，客户端运行应用修改服务器列表，但是修改会导致与服务端进行重连
#### 16、zookeeper的部署方式
 - 单机
 - 集群
#### 17、zookeeper的集群部署中有哪些角色
 - leader，集群内部各服务的调度者，保证集群事务处理的顺序
 - follower。处理非事务请求，转发给leader，参与事务请求的投票，leader选举投票
 - observe。只处理读请求，转发事务请求，不参与任何投票
 - 集群至少保证3台，或2N+1台，保证选举算法
#### 18、集群3台挂掉1台还可以使用吗
 - 过半存活原则
#### 19、是否可以动态添加
 - 3.5版本之后可以，之前需要全部重启或逐个重启
#### 20、zookeeper服务的工作状态
 - 寻找leader中
 - 跟随者状态
 - 领导者状态
 - 观察者状态
#### 21、zookeeper如何保证事务的一致性
 - zookeeper采用递增的事务id来识别，所有的提议都会加上zxid，其中高32位用来标示leader的变化，新leader的产生会增加，低32位会用来递增计数
#### 22、zookeeper集群直接的通信
 - leader服务器会和每个跟随者和观察者建立连接并未给一个创建一个learnerHandler实体
 - leaderHandler负责数据同步，转发，和投票
 - leader保存所有的learnerHandler
#### 23、zab和paxos算法的联系
 - zab用来构建高可用的分布式数据主备西永，paxos用来构建分布式一致状态机系统
 - 原则广播，和分布式选举算法
#### 24、zookeeper选举过程
 - basic paxos实现
 - fast paxos实现
#### 25、basic paxos流程
#### 26、fast paxos流程
#### 27、为什么zookeeper集群推荐节点树是单数
 - 选举过程中的过半原则
 - 过半存活原则
 - 节省资源
#### 28、zookeeper是否需存在脑裂
 -
#### 29、zookeeper的同步流程
 - leader等待server连接
 - follower连接leader。将最到的zxid发送给leader
 - leader根据follower的zxid确定同步节点
 - 完成同步后通知follower已经成为update状态
 - follower收到update消息后又重新接受client的请求进行服务
#### 30、zookeeper如果leader挂了，会不会存在本次操作数据丢失
