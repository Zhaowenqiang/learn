### redis 面试题

#### 1、Redis的优点
 - 速度快，基于内存的查找，类似map，o(1)的时间复杂度
 - 异步将内存数据刷新到磁盘
 - 支持丰富的数据类型，string，list，set，sorted set，hash
 - 丰富的特性，订阅发布，key过期策略，事务，支持多个DB，计数
 - 持久化存储，解决内存数据库在系统挂掉后数据消失
#### 2、Redis的缺点
 - 由于Redis是内存数据，存储大小受单机限制
 - 完整重同步，会占用大量cpu，生产RDB文件，并且会占用带宽
 - 修改配置文件，重启，加载数据到内存，不能提供服务
#### 3、Redis和memcacheed的区别
 - Redis支持复杂的数据类型
 - Redis原生支持集群，而memcached需要客户端往集群中分片写数据
 - 性能对比，Redis只使用单核，memcached使用多核，所以在单核并且小数据的存储上redis的性能更优
 - 100k以上数据memcached的性能高于redis
 - 内存使用效率
   - 简单的key-value存储，memcached的内存利用率高，类似于内存池
   - 如果redis采用hash结构存储keyvalue，由于组合式压缩，内存利用率高于memcached
 - 网络io模型
 - 持久化存储，memcached不支持
#### 4、redis的线程模型
 - redis内部使用了文件事件处理器，这个文件事件处理器是一个单线程的，所以redis是单线程模型
 - 4个部分，多个socket，io多路复用程序，文件事件分派器，事件处理器（连接应答，命令请求，命令回复
 - 不同的操作对应不同的文件事件，但是io多路复用程序会监听多个socket，会将socket产生的事件放入队列中排队，事件分派器每次从队列中取出事件，把事件交给对应的事件处理器
 - 客户端向redis的server socket请求连接，server socket会创建一个事件，io多路程序监听到事件之后，将事件压入事件队列，事件分派器将事件读取之后，交给连接应答处理器，连接应答处理器会创建一个能与客户端通信的socket01，并将socket01的事件与命令请求处理器关联
 - 客户端通过socket01向服务器发送一个命令，产生一个事件，io多路复用程序将事件亚茹队列，事件分派器将命令交给之前连接的命令请求处理器。命令请求处理器处理完成后，将socket的事件与命令回复处理器关联，
 - 客户端准备好接受返回值结果，那么socket01会产生一个事件，io复用器压入队列，分派器将事件交给命令回复处理器
#### 5、为什么单线程模型的redis效率这么高
 - 纯内存操作
 - 核心是基于非阻塞的io多路复用机制
 - 单线程避免多线程切换，利用队列将并发变为串行访问，消除传统数据库串行控制
 - redis全程使用hash结构，读取速度快，以及特殊数据结构的优化
#### 6、redis是单线程，如何提高多核CPU的利用率
 - 集群，在一个服务器上部署多个redis的实例
#### 7、redis的几种持久化方式
 - 两种持久化方式
   - 全量持久化RDB，在指定时间间隔内将内存中的数据集快照写入磁盘，实际操作过程是，fork一个子进程，现将数据集写入临时文件，写入成功后，在替换之前的文件，用二进制压缩存储
   - 增量持久化AOF，以日志的形式记录服务器所处理的民一个写，删除，操作，查询操作不会记录，以文本的方式记录，可以打开文件看到想去的操作记录
 - rdb的优缺点
   - 优点
   - 灵活设置备份频率和周期，一旦系统出现灾难性故障，通过备份可以非常容易恢复
   - 适合冷备份，因为是单文件的存储
   - 性能最多化，使用一个子进程就可以完成备份，不会对redis的读写服务有影响
   - 恢复快，适合恢复数据
   - 缺点
   - 容易数据丢失，在备份之前的数据，如果系统坠机会丢失数据
   - 如果数据集比较大，fork子进程的持久备份可能会导致几百毫秒的停用
 - AOF的优缺点
   - 优点
   - 更高的数据安全性，3种同步策略，每秒同步，每执行一次同步，或者不同步
   - 写入文件以日志追加的方式进行，及时写入坠机也不会影响其他数据
   - 使用的append-only模式写入，没有磁盘寻址开销
   - 如果写入一般数据坠机，第二次重启，redis-check-aof会处理数据的一致性
   - 如果日志文件过大，redis自动启用rewrite机制，即使出现后台重写，老日志文件可以写入，待新文件准备好之后替换
   - 缺点
   - 数据恢复慢
   - 不同的同步策略，运行效率上rdb的效率更高
   - 基于日志恢复数据，容易出错，以前发生过，所以是两种方式配合会好一些
#### 8、append-only模式，在操作系统的写入模式还有那些，有什么优缺点
 -
#### 9、如何选择
 - 两种持久化的方式配合使用，可以更好的满足业务
#### 10、redis的几种数据过期策略
 - 被动删除，当读写一个已经过期的key时，会除非惰性删除
 - 主动删除。惰性依赖业务，有一些数据会删不掉，所以会定期删除过期初九
 - 主动删除，在内存使用超过阈值，主动清理数据
#### 11、redis有哪几种数据淘汰策略
 - 内存数据集大小上升到一定大小的时候，会进行数据淘汰策略
 -
#### 12、redis的LRU算法，LRU算法是什么
#### 13、mysql中有2000w数据，redis中有20w数据，如何保证数据都是热点数据
 -
#### 14、redis的回收进程如何工作
 -  就是通过淘汰机制处理的，如果在添加数据时，超过阈值，在触发一次
#### 15、如果有大量的key需要设置同一时间过期，一般注意什么
 - 如果出现大量缓存失效，会导致redis出现卡顿
 - 可以在设置缓存过期时间时使用一个随机数
 - 可以调大hz提高回收的频次，默认每秒10次
#### 16、有哪些数据结构
 - 字符串
 - hash
 - list
 - set
 - sortedSet
 - hyperLogLog
 - geo
 - pub、sub
 - bloomFilter
 - redisSearch
 - redis-ml
 - json
#### 17、redis的使用场景
 - 数据缓存
 - 会话缓存
 - 时效访问
 - 访问频率
 - 技术器
 - 社交列表
 - 记录用户判断信息
 - 交集，并集。差集
 - 热门列表与排行榜
 - 最新动态
 - 消息队列
 - 分布式锁
#### 18、使用redis限制1小时内每用户id最多只能登陆5次
 - 使用列表，存储时间，列表中的数据超过5次，并且最早的一次登陆时间比现在的时间在1小时以内就禁止
#### 19、redis支持的java客户端
 - redisson 支持的功能全面
 - jedis 功能简单，但是支持的api丰富
 - lettuce springboot内置使用，内部有nio可伸缩的redis客户端，共享一个redisConnection，使用了netty
#### 20、任何用redis实现分布式锁
 - set指令，使用setNx进行抢锁，并同时设置过期时间
 - redlock放肆，很牛逼，不知道
 - 和zookeeper的比较，在可靠性上zookeeper优，性能上redis优
#### 21、如何使用redis实现分布式限流
#### 22、如何使用redis实现消息队列
 - rpush，lpop，bloop，pub，sub（1对多），sortedSet，时间戳作为score，消息内容作为key，使用制度范围查找轮询即可
#### 23、redis pipelining是什么
 - 使用管道可以将多个命令发送给服务器，而不用等待回复，加快处理
 - 使用管道可以支持数据的大批量操作
#### 24、redis的事务
 - redis事务使用multi，exec，discard，watch实现
 - 在事务中所有的命令都会被串行话，事务执行期间，redis对于其他客户端不提供服务，
 - redis事务中如果某一条执行失败，其他的命令仍然继续执行
 - 我们通过multi创建一个事务，之后的所有命令都在一个事务内，最后执行exec和discard，提交或者回滚
 - 如果在提交之前，网络中断，命令都不会被执行，如果是在exec之后，命令会被执行
 - 如果使用append only，系统会调用write，将所有写操作写入磁盘，如果在过程中故障，可能导致数据丢失
#### 25、redis的cas操作
 - 使用watch命令实现cas，如果watch之后key的的值有变化，exec命令就会执行事务失败
#### 26、redis集群有哪些方案
 -
#### 27、redis集群如何扩容
 - 如果redis被当做缓存，使用一致性哈希就可以
 - 如果是作为持久化，则必须固定keys to nodes的映射关系，节点数量不能变化，如果变化需要一个数据平衡的一套系统
#### 28、redis的主存同步
 - 主数据库服务写，从数据库负责读和同步，
 - 第一次同步是一个bgsave加上之后的操作记录进行同步
 - 提高系统的负责，在读的压力比较大的时候
#### 29、redis sentinel实现高可用
#### 30、redis cluster 实现高可用
#### 31、redis的hash槽概念
 - redis集群有16384个哈希槽，取模后决定放入那个槽，每个节点负责一部分槽，最多支持163824
#### 32、redis cluster的主从复制模型
 - 主从复制模型主要是为了处理在部分节点或者大部分节点无法通行的情况下集群可用
 - redis sentinel定位于高可用，在master宕机后slave自动为master提供服务
 - redis cluster主要为了扩展性，在单个redis不足时，使用cluster分片存储
#### 33、redis cluster集群不可用
 - 有A,B，C三个节点集群，没有复制模型时，一个宕机就不可用
#### 34、redis cluster会写操作丢失吗
 - redis并不能保证数据的强一致性，异步复制，可能导致数据丢失
#### 35、redis的部署
#### 36、redis的分区
 - redis分区是一种模式，提供了4中具有实现方案
#### 37、redis分区实现方案
 - redis分区主要分为两种，客户端分区和代理分区
 - 客户端分区，就是在客户端决定数据去哪
 - 代理分区，就是客户端将数据发送给代理，由代理决定去哪
#### 38、分布式redis是前期做和是后期做
 -
#### 39、redis的健康指标
 - 存活情况
 - 连接数
 - 阻塞客户端数量
 - 使用内存峰值
 - 内存碎片率
 - 缓存命中率
 - ops4
 - 持久化
 - 失效key
 - 慢日志
#### 40、如何提高redis命中率
 -
#### 41、redis内存优化
 - redisObject对象
 - 缩减键值对象
 - 共享对象池
 - 字符串优化
 - 编码优化
 - 控制key数量
#### 42、一个redis市里做到存放多少keys
 - 任何类型都能存放2^32
#### 43、查找已知key的某个固定的前缀
 - 使用keys，但是keys的使用会导致服务停顿
 - 使用sacn，时间较长，但是不影响线上服务，而且有重复数据，需要做去重
#### 44、redis常见的性能问题
 - master最好不要做任何持久化工作，RDB和AOF
 - master在重写AOF文件时，会占用大量cpu
 - 避免在注会压力较大时增加从库
 - 主存复制使用单向链表，不要使用图库
 - redis主存复制性能问题，为了主从复制，master和slave在一个局域网内
#### 45、修改配置不重启redis会实时生效
 - config set命令进行修改，无需执行任何形式的重启
#### 46、skiplist插入和查询原理
#### 47、压缩列表的原理
#### 48、redis的底层实现为什么使用跳跃表，而不是红黑树
 - 跳跃表在范围查找的时候性能高一些
 
